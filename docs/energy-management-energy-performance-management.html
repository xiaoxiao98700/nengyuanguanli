<div class="energy-performance-management-container">
    <style>
        /* 统一滚动条样式 */
        * {
            scrollbar-width: thin;
            scrollbar-color: #3c5472 #1a2a3a;
        }
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #1a2a3a;
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb {
            background: #3c5472;
            border-radius: 5px;
            border: 2px solid #1a2a3a;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #4a6a8a;
        }
        ::-webkit-scrollbar-thumb:active {
            background: #00bcd4;
        }
        ::-webkit-scrollbar-corner {
            background: #1a2a3a;
        }
        
        .energy-performance-management-container {
            padding: 20px;
            background-color: #0f1e2d;
        }

        .page-header {
            margin-bottom: 25px;
        }

        .page-title {
            font-size: 24px;
            color: #00bcd4;
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .page-description {
            color: #a7bed3;
            font-size: 14px;
            margin-top: 8px;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        /* 筛选区域 */
        .filter-section {
            background-color: #2a3d54;
            border: 1px solid #3c5472;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .filter-row {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-item label {
            color: #a7bed3;
            font-size: 14px;
            white-space: nowrap;
        }

        .filter-select {
            background-color: #1a2a3a;
            border: 1px solid #3c5472;
            color: #e0e6ed;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            min-width: 150px;
            cursor: pointer;
        }

        .filter-select:hover {
            border-color: #00bcd4;
        }

        .query-button {
            background-color: #00bcd4;
            border: none;
            color: #1a2a3a;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .query-button:hover {
            background-color: #00acc1;
            transform: translateY(-1px);
        }

        /* 功能模块区域 */
        .function-modules {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .function-module {
            background-color: #2a3d54;
            border: 1px solid #3c5472;
            border-radius: 8px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .function-module:hover {
            border-color: #00bcd4;
            box-shadow: 0 4px 12px rgba(0, 188, 212, 0.2);
        }

        .module-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3c5472;
        }

        .module-icon {
            font-size: 24px;
            color: #00bcd4;
        }

        .module-title {
            font-size: 18px;
            font-weight: bold;
            color: #e0e6ed;
            margin: 0;
        }

        .module-description {
            color: #a7bed3;
            font-size: 13px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        /* 图表容器 */
        .chart-container {
            height: 300px;
            background-color: #1a2a3a;
            border: 1px solid #3c5472;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5d7d9a;
            font-style: italic;
        }

        /* 数据表格 */
        .data-table-container {
            margin-top: 15px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .data-table th,
        .data-table td {
            border: 1px solid #3c5472;
            padding: 10px 12px;
            text-align: left;
        }

        .data-table th {
            background-color: #3c5472;
            color: #e0e6ed;
            font-weight: 600;
        }

        .data-table tr:nth-child(even) {
            background-color: #1a2a3a;
        }

        .data-table tr:hover {
            background-color: #3c5472;
        }

        .data-table td {
            color: #a7bed3;
        }

        /* 统计卡片 */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: #1a2a3a;
            border: 1px solid #3c5472;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: #a7bed3;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #00bcd4;
            margin-bottom: 5px;
        }

        .stat-unit {
            font-size: 11px;
            color: #5d7d9a;
        }

        /* 排名列表 */
        .ranking-list {
            margin-top: 15px;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background-color: #1a2a3a;
            border: 1px solid #3c5472;
            border-radius: 6px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .ranking-item:hover {
            border-color: #00bcd4;
            background-color: #213245;
        }

        .ranking-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #3c5472;
            color: #e0e6ed;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .ranking-number.top1 {
            background-color: #ffd700;
            color: #1a2a3a;
        }

        .ranking-number.top2 {
            background-color: #c0c0c0;
            color: #1a2a3a;
        }

        .ranking-number.top3 {
            background-color: #cd7f32;
            color: #1a2a3a;
        }

        .ranking-info {
            flex: 1;
        }

        .ranking-name {
            font-size: 14px;
            font-weight: bold;
            color: #e0e6ed;
            margin-bottom: 5px;
        }

        .ranking-value {
            font-size: 12px;
            color: #a7bed3;
        }

        .ranking-dispersion {
            font-size: 16px;
            font-weight: bold;
            color: #00bcd4;
            margin-left: 15px;
        }

        /* 目标设定区域 */
        .target-setting {
            background-color: #1a2a3a;
            border: 1px solid #3c5472;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .target-form {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .target-form-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .target-form-item label {
            color: #a7bed3;
            font-size: 13px;
        }

        .target-form-item input,
        .target-form-item select {
            background-color: #2a3d54;
            border: 1px solid #3c5472;
            color: #e0e6ed;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
        }

        .target-form-item input:focus,
        .target-form-item select:focus {
            outline: none;
            border-color: #00bcd4;
        }

        .save-target-button {
            background-color: #00bcd4;
            border: none;
            color: #1a2a3a;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .save-target-button:hover {
            background-color: #00acc1;
        }

        /* 响应式设计 */
        @media (max-width: 1200px) {
            .function-modules {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-item {
                width: 100%;
            }

            .filter-select {
                width: 100%;
            }

            .target-form {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <div class="page-header">
        <h2 class="page-title">
            <i class="fas fa-chart-line"></i>
            能源性能管理
        </h2>
        <p class="page-description">通过性能评估、对标分析、节能效果评估和离散度排名，全面管理能源成本中心的能源性能</p>
    </div>

    <!-- 筛选区域 -->
    <div class="filter-section">
        <div class="filter-row">
            <div class="filter-item">
                <label>能源成本中心：</label>
                <select class="filter-select">
                    <option>全部ECC</option>
                    <option>生产车间A</option>
                    <option>生产车间B</option>
                    <option>办公区域</option>
                    <option>辅助设施</option>
                </select>
            </div>
            <div class="filter-item">
                <label>时间范围：</label>
                <select class="filter-select">
                    <option>最近3个月</option>
                    <option>最近6个月</option>
                    <option>最近12个月</option>
                    <option>自定义</option>
                </select>
            </div>
            <div class="filter-item">
                <label>能源类型：</label>
                <select class="filter-select">
                    <option>全部</option>
                    <option>电力</option>
                    <option>天然气</option>
                    <option>水</option>
                    <option>蒸汽</option>
                </select>
            </div>
            <button class="query-button">
                <i class="fas fa-search"></i>
                查询
            </button>
        </div>
    </div>

    <!-- 功能模块区域 -->
    <div class="function-modules">
        <!-- 模块1：性能评估与目标设定 -->
        <div class="function-module">
            <div class="module-header">
                <i class="fas fa-bullseye module-icon"></i>
                <h3 class="module-title">性能评估与目标设定</h3>
            </div>
            <p class="module-description">
                建立指标：评估各能源成本中心或耗能单元的能耗趋势；建立回归分析模型，使用3-6个月历史数据建立回归分析模型，用离散度反映能耗波动控制的整体松紧度。基于分析结果，设定下一阶段能耗降低目标数据模型，并将其定义为下一阶段的动态能耗基线。
            </p>
            
            <!-- 统计卡片 -->
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-label">当前离散度</div>
                    <div class="stat-value">0.85</div>
                    <div class="stat-unit">标准差</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">目标离散度</div>
                    <div class="stat-value">0.65</div>
                    <div class="stat-unit">标准差</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">回归R²</div>
                    <div class="stat-value">0.92</div>
                    <div class="stat-unit">拟合度</div>
                </div>
            </div>

            <!-- 趋势图表 -->
            <div class="chart-container" id="trend-regression-chart"></div>

            <!-- 目标设定表单 -->
            <div class="target-setting">
                <h4 style="color: #e0e6ed; margin-bottom: 15px; font-size: 14px;">设定下一阶段目标</h4>
                <div class="target-form">
                    <div class="target-form-item">
                        <label>目标离散度：</label>
                        <input type="number" step="0.01" value="0.65" min="0" max="2">
                    </div>
                    <div class="target-form-item">
                        <label>能耗降低目标（%）：</label>
                        <input type="number" step="0.1" value="5.0" min="0" max="50">
                    </div>
                    <div class="target-form-item">
                        <label>目标周期：</label>
                        <select>
                            <option>1个月</option>
                            <option>3个月</option>
                            <option>6个月</option>
                            <option>12个月</option>
                        </select>
                    </div>
                    <div class="target-form-item">
                        <label>基线类型：</label>
                        <select>
                            <option>动态基线</option>
                            <option>静态基线</option>
                        </select>
                    </div>
                </div>
                <button class="save-target-button">
                    <i class="fas fa-save"></i>
                    保存目标设定
                </button>
            </div>
        </div>

        <!-- 模块2：性能对标 -->
        <div class="function-module">
            <div class="module-header">
                <i class="fas fa-balance-scale module-icon"></i>
                <h3 class="module-title">性能对标</h3>
            </div>
            <p class="module-description">
                衡量性能：目标仍基于回归分析建立动态数据模型，持续跟踪实际生产。跟踪状态通过残差图显示。跟踪分析各生产部分的单位能耗，识别最优生产能耗。
            </p>

            <!-- 统计卡片 -->
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-label">实际单位能耗</div>
                    <div class="stat-value">1.25</div>
                    <div class="stat-unit">kWh/件</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">目标单位能耗</div>
                    <div class="stat-value">1.15</div>
                    <div class="stat-unit">kWh/件</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">最优单位能耗</div>
                    <div class="stat-value">1.08</div>
                    <div class="stat-unit">kWh/件</div>
                </div>
            </div>

            <!-- 残差图 -->
            <div class="chart-container" id="residual-chart"></div>

            <!-- 单位能耗对比表 -->
            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>生产部分</th>
                            <th>实际单位能耗</th>
                            <th>目标单位能耗</th>
                            <th>最优单位能耗</th>
                            <th>偏差率</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>生产线A</td>
                            <td>1.25 kWh/件</td>
                            <td>1.15 kWh/件</td>
                            <td>1.08 kWh/件</td>
                            <td style="color: #f39c12;">+8.7%</td>
                        </tr>
                        <tr>
                            <td>生产线B</td>
                            <td>1.18 kWh/件</td>
                            <td>1.15 kWh/件</td>
                            <td>1.08 kWh/件</td>
                            <td style="color: #4caf50;">+2.6%</td>
                        </tr>
                        <tr>
                            <td>生产线C</td>
                            <td>1.12 kWh/件</td>
                            <td>1.15 kWh/件</td>
                            <td>1.08 kWh/件</td>
                            <td style="color: #4caf50;">-2.6%</td>
                        </tr>
                        <tr>
                            <td>包装线</td>
                            <td>0.95 kWh/件</td>
                            <td>1.00 kWh/件</td>
                            <td>0.92 kWh/件</td>
                            <td style="color: #4caf50;">-5.0%</td>
                        </tr>
                        <tr>
                            <td>辅助工序</td>
                            <td>1.05 kWh/件</td>
                            <td>1.10 kWh/件</td>
                            <td>1.02 kWh/件</td>
                            <td style="color: #4caf50;">-4.5%</td>
                        </tr>
                        <tr>
                            <td>仓储物流</td>
                            <td>0.82 kWh/件</td>
                            <td>0.90 kWh/件</td>
                            <td>0.78 kWh/件</td>
                            <td style="color: #4caf50;">-8.9%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 模块3：节能效果 -->
        <div class="function-module">
            <div class="module-header">
                <i class="fas fa-leaf module-icon"></i>
                <h3 class="module-title">节能效果</h3>
            </div>
            <p class="module-description">
                基于能耗模型和实际能耗使用模型评估节能潜力；通过跟踪监测验证节能效果。为评估各ECC的节能表现提供依据。
            </p>

            <!-- 统计卡片 -->
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-label">累计节能量</div>
                    <div class="stat-value">125.8</div>
                    <div class="stat-unit">MWh</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">节能率</div>
                    <div class="stat-value">8.5</div>
                    <div class="stat-unit">%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">节能潜力</div>
                    <div class="stat-value">45.2</div>
                    <div class="stat-unit">MWh</div>
                </div>
            </div>

            <!-- 节能效果趋势图 -->
            <div class="chart-container" id="energy-saving-trend-chart"></div>

            <!-- ECC节能表现表 -->
            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ECC名称</th>
                            <th>实际能耗</th>
                            <th>基准能耗</th>
                            <th>节能量</th>
                            <th>节能率</th>
                            <th>节能表现</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>生产车间A</td>
                            <td>850.5 MWh</td>
                            <td>920.3 MWh</td>
                            <td style="color: #4caf50;">69.8 MWh</td>
                            <td style="color: #4caf50;">7.6%</td>
                            <td style="color: #4caf50;">优秀</td>
                        </tr>
                        <tr>
                            <td>生产车间B</td>
                            <td>720.2 MWh</td>
                            <td>780.5 MWh</td>
                            <td style="color: #4caf50;">60.3 MWh</td>
                            <td style="color: #4caf50;">7.7%</td>
                            <td style="color: #4caf50;">优秀</td>
                        </tr>
                        <tr>
                            <td>办公区域</td>
                            <td>125.5 MWh</td>
                            <td>135.2 MWh</td>
                            <td style="color: #4caf50;">9.7 MWh</td>
                            <td style="color: #4caf50;">7.2%</td>
                            <td style="color: #4caf50;">良好</td>
                        </tr>
                        <tr>
                            <td>辅助设施</td>
                            <td>210.8 MWh</td>
                            <td>225.6 MWh</td>
                            <td style="color: #4caf50;">14.8 MWh</td>
                            <td style="color: #4caf50;">6.6%</td>
                            <td style="color: #4caf50;">良好</td>
                        </tr>
                        <tr>
                            <td>仓储物流中心</td>
                            <td>165.4 MWh</td>
                            <td>182.0 MWh</td>
                            <td style="color: #4caf50;">16.6 MWh</td>
                            <td style="color: #4caf50;">9.1%</td>
                            <td style="color: #4caf50;">优秀</td>
                        </tr>
                        <tr>
                            <td>生活配套区</td>
                            <td>72.6 MWh</td>
                            <td>78.5 MWh</td>
                            <td style="color: #4caf50;">5.9 MWh</td>
                            <td style="color: #4caf50;">7.5%</td>
                            <td style="color: #4caf50;">良好</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 模块4：离散度排名 -->
        <div class="function-module">
            <div class="module-header">
                <i class="fas fa-trophy module-icon"></i>
                <h3 class="module-title">离散度排名</h3>
            </div>
            <p class="module-description">
                通过离散度排名确定各类能源成本中心的能源管理水平。
            </p>

            <!-- 统计卡片 -->
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-label">平均离散度</div>
                    <div class="stat-value">0.78</div>
                    <div class="stat-unit">标准差</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">最优离散度</div>
                    <div class="stat-value">0.52</div>
                    <div class="stat-unit">标准差</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">最差离散度</div>
                    <div class="stat-value">1.25</div>
                    <div class="stat-unit">标准差</div>
                </div>
            </div>

            <!-- 离散度分布图 -->
            <div class="chart-container" id="dispersion-chart"></div>

            <!-- 排名列表 -->
            <div class="ranking-list">
                <div class="ranking-item">
                    <div class="ranking-number top1">1</div>
                    <div class="ranking-info">
                        <div class="ranking-name">生产车间C</div>
                        <div class="ranking-value">能源管理水平：优秀</div>
                    </div>
                    <div class="ranking-dispersion">0.52</div>
                </div>
                <div class="ranking-item">
                    <div class="ranking-number top2">2</div>
                    <div class="ranking-info">
                        <div class="ranking-name">生产车间A</div>
                        <div class="ranking-value">能源管理水平：优秀</div>
                    </div>
                    <div class="ranking-dispersion">0.65</div>
                </div>
                <div class="ranking-item">
                    <div class="ranking-number top3">3</div>
                    <div class="ranking-info">
                        <div class="ranking-name">生产车间B</div>
                        <div class="ranking-value">能源管理水平：良好</div>
                    </div>
                    <div class="ranking-dispersion">0.72</div>
                </div>
                <div class="ranking-item">
                    <div class="ranking-number">4</div>
                    <div class="ranking-info">
                        <div class="ranking-name">办公区域</div>
                        <div class="ranking-value">能源管理水平：良好</div>
                    </div>
                    <div class="ranking-dispersion">0.85</div>
                </div>
                <div class="ranking-item">
                    <div class="ranking-number">5</div>
                    <div class="ranking-info">
                        <div class="ranking-name">辅助设施</div>
                        <div class="ranking-value">能源管理水平：一般</div>
                    </div>
                    <div class="ranking-dispersion">1.05</div>
                </div>
                <div class="ranking-item">
                    <div class="ranking-number">6</div>
                    <div class="ranking-info">
                        <div class="ranking-name">仓储区域</div>
                        <div class="ranking-value">能源管理水平：需改进</div>
                    </div>
                    <div class="ranking-dispersion">1.25</div>
                </div>
                <div class="ranking-item">
                    <div class="ranking-number">7</div>
                    <div class="ranking-info">
                        <div class="ranking-name">后勤区域</div>
                        <div class="ranking-value">能源管理水平：待提升</div>
                    </div>
                    <div class="ranking-dispersion">1.32</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // 防止重复加载
            if (window.__energyPerformanceManagementModuleLoaded) {
                if (typeof window.initEnergyPerformanceManagement === 'function') {
                    window.initEnergyPerformanceManagement();
                }
                return;
            }
            window.__energyPerformanceManagementModuleLoaded = true;

            // 生成样例数据
            function generateSampleData() {
                // 1. 能耗趋势回归分析数据（90天）
                const trendData = [];
                const now = new Date();
                for (let i = 89; i >= 0; i--) {
                    const date = new Date(now);
                    date.setDate(date.getDate() - i);
                    const day = date.getDate();
                    const month = date.getMonth() + 1;
                    
                    // 模拟能耗数据（带趋势和波动）
                    const baseEnergy = 850 + Math.sin(i / 30) * 50; // 周期性波动
                    const noise = (Math.random() - 0.5) * 40; // 随机噪声
                    const actualEnergy = baseEnergy + noise;
                    
                    // 回归预测值（线性回归 + 周期性）
                    const predictedEnergy = 850 + (i - 45) * 0.2 + Math.sin(i / 30) * 50;
                    
                    // 离散度区间（±标准差）
                    const stdDev = 0.85 * 20; // 离散度0.85对应的标准差
                    const upperBound = predictedEnergy + stdDev;
                    const lowerBound = predictedEnergy - stdDev;
                    
                    trendData.push({
                        date: `${month}/${day}`,
                        actual: actualEnergy,
                        predicted: predictedEnergy,
                        upper: upperBound,
                        lower: lowerBound
                    });
                }

                // 2. 残差数据
                const residualData = trendData.map((d, i) => ({
                    index: i,
                    residual: d.actual - d.predicted,
                    predicted: d.predicted
                }));

                // 3. 节能效果数据（90天）
                const savingData = [];
                for (let i = 89; i >= 0; i--) {
                    const date = new Date(now);
                    date.setDate(date.getDate() - i);
                    const day = date.getDate();
                    const month = date.getMonth() + 1;
                    
                    const baseline = 920 + Math.sin(i / 30) * 60;
                    const actual = 850 + Math.sin(i / 30) * 50 + (Math.random() - 0.5) * 40;
                    const saving = baseline - actual;
                    
                    savingData.push({
                        date: `${month}/${day}`,
                        baseline: baseline,
                        actual: actual,
                        saving: saving
                    });
                }

                // 4. 离散度分布数据（各ECC）
                const dispersionData = [
                    { name: '生产车间C', value: 0.52 },
                    { name: '生产车间A', value: 0.65 },
                    { name: '生产车间B', value: 0.72 },
                    { name: '办公区域', value: 0.85 },
                    { name: '辅助设施', value: 1.05 },
                    { name: '仓储区域', value: 1.25 },
                    { name: '后勤区域', value: 1.32 }
                ];

                return { trendData, residualData, savingData, dispersionData };
            }

            // 渲染能耗趋势回归分析图
            function renderTrendRegressionChart(data) {
                const container = document.getElementById('trend-regression-chart');
                if (!container) return;

                const containerWidth = container.offsetWidth || container.clientWidth || 800;
                const containerHeight = 300;
                const padding = { top: 20, right: 20, bottom: 40, left: 60 };
                const width = containerWidth - padding.left - padding.right;
                const height = containerHeight - padding.top - padding.bottom;

                const maxEnergy = Math.max(...data.map(d => Math.max(d.actual, d.upper)));
                const minEnergy = Math.min(...data.map(d => Math.min(d.actual, d.lower)));
                const energyRange = maxEnergy - minEnergy;
                const yScale = height / energyRange;

                let svg = `
                    <svg width="100%" height="100%" viewBox="0 0 ${containerWidth} ${containerHeight}" preserveAspectRatio="xMidYMid meet">
                        <defs>
                            <linearGradient id="areaGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#00bcd4;stop-opacity:0.3" />
                                <stop offset="100%" style="stop-color:#00bcd4;stop-opacity:0.05" />
                            </linearGradient>
                        </defs>
                        
                        <!-- Y轴网格线 -->
                        ${Array.from({length: 6}, (_, i) => {
                            const y = padding.top + (height / 5) * i;
                            const value = maxEnergy - (energyRange / 5) * i;
                            return `<line x1="${padding.left}" y1="${y}" x2="${padding.left + width}" y2="${y}" stroke="#3c5472" stroke-width="1" opacity="0.5"/>`;
                        }).join('')}
                        
                        <!-- Y轴标签 -->
                        ${Array.from({length: 6}, (_, i) => {
                            const y = padding.top + (height / 5) * i;
                            const value = maxEnergy - (energyRange / 5) * i;
                            return `<text x="${padding.left - 10}" y="${y + 5}" fill="#a7bed3" font-size="11" text-anchor="end">${value.toFixed(0)}</text>`;
                        }).join('')}
                        
                        <!-- 离散度区间（填充区域） -->
                        <path d="M ${padding.left},${padding.top + height - (data[0].lower - minEnergy) * yScale} 
                            ${data.map((d, i) => {
                                const x = padding.left + (width / (data.length - 1)) * i;
                                const y = padding.top + height - (d.lower - minEnergy) * yScale;
                                return `L ${x},${y}`;
                            }).join(' ')}
                            ${data.map((d, i) => {
                                const x = padding.left + (width / (data.length - 1)) * i;
                                const y = padding.top + height - (d.upper - minEnergy) * yScale;
                                return `L ${x},${y}`;
                            }).reverse().join(' ')} Z" 
                            fill="url(#areaGradient)" stroke="none"/>
                        
                        <!-- 回归曲线（预测值） -->
                        <polyline points="${data.map((d, i) => {
                            const x = padding.left + (width / (data.length - 1)) * i;
                            const y = padding.top + height - (d.predicted - minEnergy) * yScale;
                            return `${x},${y}`;
                        }).join(' ')}" 
                            fill="none" stroke="#ff9800" stroke-width="2" stroke-dasharray="5,5"/>
                        
                        <!-- 实际数据线 -->
                        <polyline points="${data.map((d, i) => {
                            const x = padding.left + (width / (data.length - 1)) * i;
                            const y = padding.top + height - (d.actual - minEnergy) * yScale;
                            return `${x},${y}`;
                        }).join(' ')}" 
                            fill="none" stroke="#00bcd4" stroke-width="2"/>
                        
                        <!-- 数据点 -->
                        ${data.filter((d, i) => i % 10 === 0).map((d, i) => {
                            const idx = i * 10;
                            const x = padding.left + (width / (data.length - 1)) * idx;
                            const y = padding.top + height - (d.actual - minEnergy) * yScale;
                            return `<circle cx="${x}" cy="${y}" r="3" fill="#00bcd4" stroke="#1a2a3a" stroke-width="1"/>`;
                        }).join('')}
                        
                        <!-- X轴标签 -->
                        ${data.filter((d, i) => i % 15 === 0 || i === data.length - 1).map((d, i) => {
                            const idx = i * 15;
                            const x = padding.left + (width / (data.length - 1)) * idx;
                            return `<text x="${x}" y="${height + padding.top + 20}" fill="#a7bed3" font-size="10" text-anchor="middle">${d.date}</text>`;
                        }).join('')}
                        
                        <!-- 图例 -->
                        <g transform="translate(${containerWidth - 200}, ${padding.top + 10})">
                            <line x1="0" y1="0" x2="30" y2="0" stroke="#00bcd4" stroke-width="2"/>
                            <text x="35" y="4" fill="#a7bed3" font-size="11">实际能耗</text>
                            <line x1="0" y1="20" x2="30" y2="20" stroke="#ff9800" stroke-width="2" stroke-dasharray="5,5"/>
                            <text x="35" y="24" fill="#a7bed3" font-size="11">回归预测</text>
                            <rect x="0" y="38" width="30" height="12" fill="url(#areaGradient)"/>
                            <text x="35" y="48" fill="#a7bed3" font-size="11">离散度区间</text>
                        </g>
                    </svg>
                `;

                container.innerHTML = svg;
            }

            // 渲染残差图
            function renderResidualChart(data) {
                const container = document.getElementById('residual-chart');
                if (!container) return;

                const containerWidth = container.offsetWidth || container.clientWidth || 800;
                const containerHeight = 300;
                const padding = { top: 20, right: 20, bottom: 40, left: 60 };
                const width = containerWidth - padding.left - padding.right;
                const height = containerHeight - padding.top - padding.bottom;

                const maxResidual = Math.max(...data.map(d => Math.abs(d.residual)));
                const residualRange = maxResidual * 2;
                const yScale = height / residualRange;
                const centerY = padding.top + height / 2;

                let svg = `
                    <svg width="100%" height="100%" viewBox="0 0 ${containerWidth} ${containerHeight}" preserveAspectRatio="xMidYMid meet">
                        <!-- Y轴网格线 -->
                        ${Array.from({length: 7}, (_, i) => {
                            const y = padding.top + (height / 6) * i;
                            const value = maxResidual - (residualRange / 6) * i;
                            return `<line x1="${padding.left}" y1="${y}" x2="${padding.left + width}" y2="${y}" stroke="#3c5472" stroke-width="1" opacity="0.5"/>`;
                        }).join('')}
                        
                        <!-- 零线 -->
                        <line x1="${padding.left}" y1="${centerY}" x2="${padding.left + width}" y2="${centerY}" 
                            stroke="#00bcd4" stroke-width="2" stroke-dasharray="3,3"/>
                        
                        <!-- Y轴标签 -->
                        ${Array.from({length: 7}, (_, i) => {
                            const y = padding.top + (height / 6) * i;
                            const value = maxResidual - (residualRange / 6) * i;
                            return `<text x="${padding.left - 10}" y="${y + 5}" fill="#a7bed3" font-size="11" text-anchor="end">${value.toFixed(1)}</text>`;
                        }).join('')}
                        
                        <!-- 散点 -->
                        ${data.filter((d, i) => i % 3 === 0).map((d, i) => {
                            const idx = i * 3;
                            const x = padding.left + (width / (data.length - 1)) * idx;
                            const y = centerY - d.residual * yScale;
                            const color = Math.abs(d.residual) > maxResidual * 0.6 ? '#f39c12' : '#00bcd4';
                            return `<circle cx="${x}" cy="${y}" r="4" fill="${color}" stroke="#1a2a3a" stroke-width="1" opacity="0.7">
                                <title>残差: ${d.residual.toFixed(2)}</title>
                            </circle>`;
                        }).join('')}
                        
                        <!-- X轴标签 -->
                        <text x="${padding.left + width / 2}" y="${height + padding.top + 30}" fill="#a7bed3" font-size="12" text-anchor="middle">预测值</text>
                        <text x="${padding.left - 30}" y="${centerY}" fill="#a7bed3" font-size="12" text-anchor="middle" transform="rotate(-90, ${padding.left - 30}, ${centerY})">残差</text>
                    </svg>
                `;

                container.innerHTML = svg;
            }

            // 渲染节能效果趋势图
            function renderEnergySavingTrendChart(data) {
                const container = document.getElementById('energy-saving-trend-chart');
                if (!container) return;

                const containerWidth = container.offsetWidth || container.clientWidth || 800;
                const containerHeight = 300;
                const padding = { top: 20, right: 20, bottom: 40, left: 60 };
                const width = containerWidth - padding.left - padding.right;
                const height = containerHeight - padding.top - padding.bottom;

                const maxEnergy = Math.max(...data.map(d => Math.max(d.baseline, d.actual)));
                const minEnergy = Math.min(...data.map(d => Math.min(d.baseline, d.actual)));
                const energyRange = maxEnergy - minEnergy;
                const yScale = height / energyRange;

                let svg = `
                    <svg width="100%" height="100%" viewBox="0 0 ${containerWidth} ${containerHeight}" preserveAspectRatio="xMidYMid meet">
                        <defs>
                            <linearGradient id="savingGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#4caf50;stop-opacity:0.3" />
                                <stop offset="100%" style="stop-color:#4caf50;stop-opacity:0.05" />
                            </linearGradient>
                        </defs>
                        
                        <!-- Y轴网格线 -->
                        ${Array.from({length: 6}, (_, i) => {
                            const y = padding.top + (height / 5) * i;
                            const value = maxEnergy - (energyRange / 5) * i;
                            return `<line x1="${padding.left}" y1="${y}" x2="${padding.left + width}" y2="${y}" stroke="#3c5472" stroke-width="1" opacity="0.5"/>`;
                        }).join('')}
                        
                        <!-- Y轴标签 -->
                        ${Array.from({length: 6}, (_, i) => {
                            const y = padding.top + (height / 5) * i;
                            const value = maxEnergy - (energyRange / 5) * i;
                            return `<text x="${padding.left - 10}" y="${y + 5}" fill="#a7bed3" font-size="11" text-anchor="end">${value.toFixed(0)}</text>`;
                        }).join('')}
                        
                        <!-- 节能量填充区域 -->
                        <path d="M ${padding.left},${padding.top + height - (data[0].baseline - minEnergy) * yScale} 
                            ${data.map((d, i) => {
                                const x = padding.left + (width / (data.length - 1)) * i;
                                const y = padding.top + height - (d.baseline - minEnergy) * yScale;
                                return `L ${x},${y}`;
                            }).join(' ')}
                            ${data.map((d, i) => {
                                const x = padding.left + (width / (data.length - 1)) * i;
                                const y = padding.top + height - (d.actual - minEnergy) * yScale;
                                return `L ${x},${y}`;
                            }).reverse().join(' ')} Z" 
                            fill="url(#savingGradient)" stroke="none"/>
                        
                        <!-- 基准能耗线 -->
                        <polyline points="${data.map((d, i) => {
                            const x = padding.left + (width / (data.length - 1)) * i;
                            const y = padding.top + height - (d.baseline - minEnergy) * yScale;
                            return `${x},${y}`;
                        }).join(' ')}" 
                            fill="none" stroke="#f39c12" stroke-width="2" stroke-dasharray="5,5"/>
                        
                        <!-- 实际能耗线 -->
                        <polyline points="${data.map((d, i) => {
                            const x = padding.left + (width / (data.length - 1)) * i;
                            const y = padding.top + height - (d.actual - minEnergy) * yScale;
                            return `${x},${y}`;
                        }).join(' ')}" 
                            fill="none" stroke="#4caf50" stroke-width="2"/>
                        
                        <!-- 数据点 -->
                        ${data.filter((d, i) => i % 10 === 0).map((d, i) => {
                            const idx = i * 10;
                            const x = padding.left + (width / (data.length - 1)) * idx;
                            const y = padding.top + height - (d.actual - minEnergy) * yScale;
                            return `<circle cx="${x}" cy="${y}" r="3" fill="#4caf50" stroke="#1a2a3a" stroke-width="1"/>`;
                        }).join('')}
                        
                        <!-- X轴标签 -->
                        ${data.filter((d, i) => i % 15 === 0 || i === data.length - 1).map((d, i) => {
                            const idx = i * 15;
                            const x = padding.left + (width / (data.length - 1)) * idx;
                            return `<text x="${x}" y="${height + padding.top + 20}" fill="#a7bed3" font-size="10" text-anchor="middle">${d.date}</text>`;
                        }).join('')}
                        
                        <!-- 图例 -->
                        <g transform="translate(${containerWidth - 200}, ${padding.top + 10})">
                            <line x1="0" y1="0" x2="30" y2="0" stroke="#4caf50" stroke-width="2"/>
                            <text x="35" y="4" fill="#a7bed3" font-size="11">实际能耗</text>
                            <line x1="0" y1="20" x2="30" y2="20" stroke="#f39c12" stroke-width="2" stroke-dasharray="5,5"/>
                            <text x="35" y="24" fill="#a7bed3" font-size="11">基准能耗</text>
                            <rect x="0" y="38" width="30" height="12" fill="url(#savingGradient)"/>
                            <text x="35" y="48" fill="#a7bed3" font-size="11">节能量</text>
                        </g>
                    </svg>
                `;

                container.innerHTML = svg;
            }

            // 渲染离散度分布图
            function renderDispersionChart(data) {
                const container = document.getElementById('dispersion-chart');
                if (!container) return;

                const containerWidth = container.offsetWidth || container.clientWidth || 800;
                const containerHeight = 300;
                const padding = { top: 20, right: 20, bottom: 60, left: 60 };
                const width = containerWidth - padding.left - padding.right;
                const height = containerHeight - padding.top - padding.bottom;

                const maxValue = Math.max(...data.map(d => d.value));
                const barWidth = width / data.length * 0.7;
                const barGap = width / data.length * 0.3;

                let svg = `
                    <svg width="100%" height="100%" viewBox="0 0 ${containerWidth} ${containerHeight}" preserveAspectRatio="xMidYMid meet">
                        <!-- Y轴网格线 -->
                        ${Array.from({length: 6}, (_, i) => {
                            const y = padding.top + (height / 5) * i;
                            const value = maxValue - (maxValue / 5) * i;
                            return `<line x1="${padding.left}" y1="${y}" x2="${padding.left + width}" y2="${y}" stroke="#3c5472" stroke-width="1" opacity="0.5"/>`;
                        }).join('')}
                        
                        <!-- Y轴标签 -->
                        ${Array.from({length: 6}, (_, i) => {
                            const y = padding.top + (height / 5) * i;
                            const value = maxValue - (maxValue / 5) * i;
                            return `<text x="${padding.left - 10}" y="${y + 5}" fill="#a7bed3" font-size="11" text-anchor="end">${value.toFixed(2)}</text>`;
                        }).join('')}
                        
                        <!-- 柱状图 -->
                        ${data.map((d, i) => {
                            const x = padding.left + (width / data.length) * i + barGap / 2;
                            const barHeight = (d.value / maxValue) * height;
                            const y = padding.top + height - barHeight;
                            const color = d.value <= 0.65 ? '#4caf50' : d.value <= 0.85 ? '#ff9800' : '#f44336';
                            return `
                                <rect x="${x}" y="${y}" width="${barWidth}" height="${barHeight}" 
                                    fill="${color}" opacity="0.8" rx="2">
                                    <title>${d.name}: ${d.value.toFixed(2)}</title>
                                </rect>
                                <text x="${x + barWidth / 2}" y="${y - 5}" fill="#a7bed3" font-size="10" text-anchor="middle">${d.value.toFixed(2)}</text>
                            `;
                        }).join('')}
                        
                        <!-- X轴标签 -->
                        ${data.map((d, i) => {
                            const x = padding.left + (width / data.length) * i + width / data.length / 2;
                            return `<text x="${x}" y="${height + padding.top + 20}" fill="#a7bed3" font-size="10" text-anchor="middle" transform="rotate(-45, ${x}, ${height + padding.top + 20})">${d.name}</text>`;
                        }).join('')}
                        
                        <!-- Y轴标题 -->
                        <text x="${padding.left - 30}" y="${padding.top + height / 2}" fill="#a7bed3" font-size="12" text-anchor="middle" transform="rotate(-90, ${padding.left - 30}, ${padding.top + height / 2})">离散度</text>
                    </svg>
                `;

                container.innerHTML = svg;
            }

            // 初始化
            function initEnergyPerformanceManagement() {
                const sampleData = generateSampleData();
                renderTrendRegressionChart(sampleData.trendData);
                renderResidualChart(sampleData.residualData);
                renderEnergySavingTrendChart(sampleData.savingData);
                renderDispersionChart(sampleData.dispersionData);
            }

            // 确保初始化
            function ensureInit() {
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => {
                        setTimeout(initEnergyPerformanceManagement, 200);
                    });
                } else {
                    setTimeout(initEnergyPerformanceManagement, 300);
                }
            }

            window.initEnergyPerformanceManagement = initEnergyPerformanceManagement;
            ensureInit();
        })();
    </script>
</div>
